<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Daniel Nill</title>
<meta name="description" content="">
<meta name="keywords" content="">
<!-- Twitter Cards -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="/images/texture-feature-06.jpg">

<meta name="twitter:title" content="Daniel Nill">
<meta name="twitter:description" content="">
<meta name="twitter:creator" content="@DanielNill">
<link type="application/atom+xml" rel="alternate" href="/feed.xml" title="Daniel Nill" />

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Daniel Nill">
<meta property="og:description" content="">
<meta property="og:url" content="/">
<meta property="og:site_name" content="Daniel Nill">





<link rel="canonical" href="/">
<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Daniel Nill Feed">


<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Google Webfonts -->
<link href='http://fonts.googleapis.com/css?family=PT+Sans+Narrow:400,700|PT+Serif:400,700,400italic' rel='stylesheet' type='text/css'>
<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.min.css">

<!--[if (lt IE 9) & (!IEMobile)]>
<link rel="stylesheet" href="/assets/css/ie.min.css">
<![endif]-->

<meta http-equiv="cleartype" content="on">

</head>

<body class="home" itemscope itemtype="http://schema.org/WebPage">

<!--[if lt IE 9]><div class="browser-upgrade alert alert-info">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div><![endif]-->

<div class="navigation-wrapper">
	<div class="site-name">
		<a href="">Daniel Nill</a>
	</div><!-- /.site-name -->
	<div class="top-navigation">
		<nav role="navigation" itemscope itemtype="http://schema.org/SiteNavigationElement">
		    <ul>
		        
				<li><a href="/" >Posts</a></li>
		        
				<li><a href="/about.html" >About</a></li>
		        
		    </ul>
		</nav>
	</div><!-- /.top-navigation -->
</div><!-- /.navigation-wrapper -->


<div class="image-wrap">
  <!--<img src="/images/texture-feature-06.jpg" alt=" feature image" itemprop="primaryImageOfPage">-->
  <!---->
</div><!-- /.image-wrap -->

<div class="article-author-side">
  <!-- <img src="/images/profile-photo-new1.jpg" class="bio-photo" alt="Daniel Nill bio photo"></a> -->
<p></p>
<br/>
<a href="http://twitter.com/DanielNill" class="author-social" target="_blank"><i class="icon-twitter"></i> Twitter</a>


<a href="http://linkedin.com/in/danielnill" class="author-social" target="_blank"><i class="icon-linkedin"></i> LinkedIn</a>

<a href="http://github.com/DanielNill" class="author-social" target="_blank"><i class="icon-github"></i> Github</a>



</div>
<div id="index" itemprop="mainContentOfPage" itemscope itemtype="http://schema.org/Blog">
  <!-- <h3><a href="/">Posts</a></h3> -->
  
    <article itemscope itemtype="http://schema.org/BlogPosting" itemprop="blogPost" class="listed_article">
      <h2 class="listed_headline" temprop="headline"><a href="/rust_tip_compairing_strings" rel="bookmark" title="A Quick Rust tip (Comparing Strings)">A Quick Rust tip (Comparing Strings)</a></h2>
      <small class="article_date">08 Dec 2016</small><br /><br />
      <p itemprop="text"><p>I have been learning <a href="https://www.rust-lang.org/en-US/">rust</a> recently and so wanted to start tracking things that I’ve learned.</p>

<p>You can learn a lot more about strings in rust via <a href="http://www.steveklabnik.com/rust-issue-17340/">this explainer</a> but one thing I got hung up on was comparing strings.</p>

<p>There are two types of strings in rust, <code class="language-plaintext highlighter-rouge">&amp;str</code> and <code class="language-plaintext highlighter-rouge">String</code>.  It seems that rust is pretty good about deciding which type you want a <code class="language-plaintext highlighter-rouge">"some string"</code> to be, but I was having trouble doing something like this:</p>

<figure class="highlight"><pre><code class="language-rust" data-lang="rust">    <span class="k">let</span> <span class="k">mut</span> <span class="n">guess</span> <span class="o">=</span> <span class="nn">String</span><span class="p">::</span><span class="nf">new</span><span class="p">();</span>

    <span class="nn">io</span><span class="p">::</span><span class="nf">stdin</span><span class="p">()</span><span class="nf">.read_line</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">guess</span><span class="p">)</span><span class="nf">.expect</span><span class="p">(</span><span class="s">"Failed to read line"</span><span class="p">);</span>
    
    <span class="k">if</span> <span class="n">guess</span> <span class="o">==</span> <span class="s">"Q"</span> <span class="p">{</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"Goodbye"</span><span class="p">);</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span></code></pre></figure>

<p>I was worried that while <code class="language-plaintext highlighter-rouge">guess</code> was a <code class="language-plaintext highlighter-rouge">String</code> <code class="language-plaintext highlighter-rouge">"Q"</code> was a <code class="language-plaintext highlighter-rouge">&amp;str</code>.  Turns out the issue was with the way the <code class="language-plaintext highlighter-rouge">read_line</code> formats the string when reading it.  By default there is a newline character at the end of the string so you need to use <code class="language-plaintext highlighter-rouge">trim()</code>.</p>

<figure class="highlight"><pre><code class="language-rust" data-lang="rust">    <span class="k">let</span> <span class="k">mut</span> <span class="n">guess</span> <span class="o">=</span> <span class="nn">String</span><span class="p">::</span><span class="nf">new</span><span class="p">();</span>

    <span class="nn">io</span><span class="p">::</span><span class="nf">stdin</span><span class="p">()</span><span class="nf">.read_line</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">guess</span><span class="p">)</span><span class="nf">.expect</span><span class="p">(</span><span class="s">"Failed to read line"</span><span class="p">);</span>
    
    <span class="k">if</span> <span class="n">guess</span><span class="nf">.trim</span><span class="p">()</span> <span class="o">==</span> <span class="s">"Q"</span> <span class="p">{</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"Goodbye"</span><span class="p">);</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span></code></pre></figure>

</p>
    </article>
    <br />
    <hr >
    <br />
  
    <article itemscope itemtype="http://schema.org/BlogPosting" itemprop="blogPost" class="listed_article">
      <h2 class="listed_headline" temprop="headline"><a href="/behind-the-scenes-with-nil-and-empty" rel="bookmark" title="Behind the Scenes with nil? and empty?">Behind the Scenes with nil? and empty?</a></h2>
      <small class="article_date">04 Jan 2014</small><br /><br />
      <p itemprop="text"><p>At their base level the ruby methods nil? and empty? are just contents checks with slightly different focuses.  But I thought it would be interesting and maybe even useful to look at how each actually opperates.</p>

<h4 id="why-are-you-writing-this">Why are you writing this</h4>

<p>Mostly just for shits and giggles, and because I was currious about the core implementations of these methods.</p>

<h4 id="nil">nil?</h4>

<p>First, let’s take a look at <code class="language-plaintext highlighter-rouge">nil?</code>.  It is the most simplistic of the three methods and is easy to understand at a source code level.  First we should know what the method does.  Calling <code class="language-plaintext highlighter-rouge">nil?</code> simply checks the object is is called on and returns whether it is of the nil object type or not.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">  <span class="kp">nil</span><span class="p">.</span><span class="nf">nil?</span> <span class="c1"># =&gt; true</span>
  <span class="s2">""</span><span class="p">.</span><span class="nf">nil?</span> <span class="c1"># =&gt; false</span>
  <span class="mi">0</span><span class="p">.</span><span class="nf">nil?</span> <span class="c1"># =&gt; false</span>
  <span class="p">[].</span><span class="nf">nil?</span> <span class="c1"># =&gt; false</span>
  <span class="p">{}.</span><span class="nf">nil?</span> <span class="c1"># =&gt; false</span>
  <span class="no">NilClass</span><span class="p">.</span><span class="nf">nil?</span> <span class="c1"># =&gt; false</span></code></pre></figure>

<p>If you accept that <code class="language-plaintext highlighter-rouge">nil?</code> will only return true if it’s owner is nil, this everything in this result set should make sense.  The only thing that might give you pause is <code class="language-plaintext highlighter-rouge">NilClass.nil? # =&gt; false</code>, but this should be quickly cleared up by seeing that NilClass is the class of the singleton object nil in ruby.  This simply means that NilClass can only instantiate to the instance nil, and is only instantiated through the keyword <code class="language-plaintext highlighter-rouge">nil</code>.</p>

<p>To implement this functionality, ruby does four things in its source:</p>

<figure class="highlight"><pre><code class="language-c" data-lang="c">  <span class="c1">// 1) define a function to return the ruby object false</span>
  <span class="k">static</span> <span class="n">VALUE</span>
  <span class="nf">rb_false</span><span class="p">(</span><span class="n">VALUE</span> <span class="n">obj</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">return</span> <span class="n">Qfalse</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// 2) define a function to return the ruby object true</span>
  <span class="k">static</span> <span class="n">VALUE</span>
  <span class="nf">rb_true</span><span class="p">(</span><span class="n">VALUE</span> <span class="n">obj</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">return</span> <span class="n">Qtrue</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// 3) define the Object class and assign functionality to the nil? method</span>
  <span class="n">rb_mKernel</span> <span class="o">=</span> <span class="n">rb_define_module</span><span class="p">(</span><span class="s">"Kernel"</span><span class="p">);</span>
  <span class="n">rb_define_method</span><span class="p">(</span><span class="n">rb_mKernel</span><span class="p">,</span> <span class="s">"nil?"</span><span class="p">,</span> <span class="n">rb_false</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

  <span class="c1">// 4) define the NilClass and assign functionality to the nil? method</span>
  <span class="n">rb_cNilClass</span> <span class="o">=</span> <span class="n">rb_define_class</span><span class="p">(</span><span class="s">"NilClass"</span><span class="p">,</span> <span class="n">rb_cObject</span><span class="p">);</span>
  <span class="n">rb_define_method</span><span class="p">(</span><span class="n">rb_cNilClass</span><span class="p">,</span> <span class="s">"nil?"</span><span class="p">,</span> <span class="n">rb_true</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span></code></pre></figure>

<p>Most of this is pretty straight forward but there are a few things to make note of.  <code class="language-plaintext highlighter-rouge">VALUE</code> is a pointer to an object, so it’s use in this code is simply stating that both methods take in an object and return an object.  More specifically for the <code class="language-plaintext highlighter-rouge">rb_true</code> and <code class="language-plaintext highlighter-rouge">rb_false</code> methods they take take in an instance of the base ruby Object class and return an either an instance of TrueClass or FalseClass.</p>

<p><code class="language-plaintext highlighter-rouge">Qfalse</code> and <code class="language-plaintext highlighter-rouge">Qtrue</code> are instances of  <code class="language-plaintext highlighter-rouge">VALUE</code> and represent the singleton objects of the ruby classes TrueClass and FalseClass.  This is significant only in that it is useful to note that ruby’s true and false are not the same thing as c’s true and false, although they can be converted.</p>

<p>Next, you’ll probably note the strange method <code class="language-plaintext highlighter-rouge">rb_define_module</code>.  This function creates a module that is used in this case by the Object class which is defined by <code class="language-plaintext highlighter-rouge">rb_cObject = rb_define_class("Object", rb_cBasicObject);</code>.  Methods that are core to the Object class and don’t extend to other classes are defined directly on the object class where as methods that do extend are defined on the kernal module.</p>

<p>Lastly <code class="language-plaintext highlighter-rouge">rb_define_method</code> takes an class definition, a stringified name for the method being defined, a function pointer to deliver it’s returned value and the number of arguments expected to be passed to the method.</p>

<h4 id="empty">empty?</h4>

<p><code class="language-plaintext highlighter-rouge">empty?</code> is a core ruby method, but it is only implemented on certain ruby object types. It is not implemented on the ruby ObjectClass and then extended to all other clases.  Instead it is implemented only on classes that can have a lenght or count.  First a few examples.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="p">[].</span><span class="nf">empty?</span> <span class="c1"># =&gt; true</span>
<span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nf">empty?</span> <span class="c1"># =&gt; false</span>
<span class="p">{}.</span><span class="nf">empty?</span> <span class="c1"># =&gt; true</span>
<span class="p">{</span> <span class="ss">a: </span><span class="mi">1</span> <span class="p">}.</span><span class="nf">empty?</span> <span class="c1"># =&gt; false</span>
<span class="s2">""</span><span class="p">.</span><span class="nf">empty?</span> <span class="c1"># =&gt; true</span>
<span class="s2">"hello"</span><span class="p">.</span><span class="nf">empty?</span> <span class="c1"># =&gt; false</span>
<span class="ss">:hello</span><span class="p">.</span><span class="nf">empty?</span> <span class="c1"># =&gt; false</span>
<span class="ss">:""</span><span class="p">.</span><span class="nf">empty?</span> <span class="c1"># =&gt; true</span></code></pre></figure>

<p>Again, going through how these results are generated will give a deeper understanding of what is actually happening when we make even these basic method calls.</p>

<p>First, let’s look at the source codes for the <code class="language-plaintext highlighter-rouge">empty?</code> methods.</p>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="c1">// String#empty?</span>
<span class="k">static</span> <span class="n">VALUE</span>
<span class="nf">rb_str_empty</span><span class="p">(</span><span class="n">VALUE</span> <span class="n">str</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">RSTRING_LEN</span><span class="p">(</span><span class="n">str</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Qtrue</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">Qfalse</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">//...</span>
<span class="n">rb_define_method</span><span class="p">(</span><span class="n">rb_cString</span><span class="p">,</span> <span class="s">"empty?"</span><span class="p">,</span> <span class="n">rb_str_empty</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span></code></pre></figure>

<p>This looks relatively familiar to what we saw before with the <code class="language-plaintext highlighter-rouge">nil?</code> definition.  There’s a little more logic but it’s really not too hard to work through.</p>

<p>First we see that the function takes in a <code class="language-plaintext highlighter-rouge">VALUE</code> pointer object and returns a <code class="language-plaintext highlighter-rouge">VALUE</code> pointer object.  In this case it takes in a pointer to an object that is expected to be a string and returns a the <code class="language-plaintext highlighter-rouge">Qtrue</code> or <code class="language-plaintext highlighter-rouge">Qfalse</code> <code class="language-plaintext highlighter-rouge">VALUE</code> instances.  When we look at the logic inside the function we can see that is does exactly what we’d expect it to do.  It checks the string’s length using <code class="language-plaintext highlighter-rouge">RSTRING_LEN</code>, a custom string length method implemented for ruby, and return <code class="language-plaintext highlighter-rouge">Qtrue</code> if that length is 0.</p>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="c1">// Array#empty?</span>
<span class="k">static</span> <span class="n">VALUE</span>
<span class="nf">rb_ary_empty_p</span><span class="p">(</span><span class="n">VALUE</span> <span class="n">ary</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">RARRAY_LEN</span><span class="p">(</span><span class="n">ary</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Qtrue</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">Qfalse</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">//...</span>
<span class="n">rb_define_method</span><span class="p">(</span><span class="n">rb_cArray</span><span class="p">,</span> <span class="s">"empty?"</span><span class="p">,</span> <span class="n">rb_ary_empty_p</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span></code></pre></figure>

<p>Next, looking at the array empty method we see very similar code.  Again, the function takes in and returns <code class="language-plaintext highlighter-rouge">VALUE</code> and again it uses a custom string length function, this time <code class="language-plaintext highlighter-rouge">RARRAY_LEN</code> to check the length of the object. Again, <code class="language-plaintext highlighter-rouge">RARRAY_LEN</code> is simply a wrapper for getting the memory allocated for the array in question.  It is worth noting that an empty array in ruby does not coorespond to an empty array in C.</p>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="c1">// Hash#empty?</span>
<span class="k">static</span> <span class="n">VALUE</span>
<span class="nf">rb_hash_empty_p</span><span class="p">(</span><span class="n">VALUE</span> <span class="n">hash</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="n">RHASH_EMPTY_P</span><span class="p">(</span><span class="n">hash</span><span class="p">)</span> <span class="o">?</span> <span class="n">Qtrue</span> <span class="o">:</span> <span class="n">Qfalse</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">//...</span>
<span class="n">rb_define_method</span><span class="p">(</span><span class="n">rb_cHash</span><span class="p">,</span><span class="s">"empty?"</span><span class="p">,</span> <span class="n">rb_hash_empty_p</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span></code></pre></figure>

<p>Again, in the hash version of the function everything looks very similar.  However, there is a small diference.  This time we aren’t checking that the hash has no length, instead we are actually checking that it is empty.  This is simply because it is more expensive to get the length of a hash than it is to get the length of an array.  With an array you can simply check how much memory is allocated, where as with a hash you have to actually count the number of entities.</p>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="n">Looking</span> <span class="n">at</span>
<span class="c1">// Symbol#empty?</span>
<span class="k">static</span> <span class="n">VALUE</span>
<span class="nf">sym_empty</span><span class="p">(</span><span class="n">VALUE</span> <span class="n">sym</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="n">rb_str_empty</span><span class="p">(</span><span class="n">rb_id2str</span><span class="p">(</span><span class="n">SYM2ID</span><span class="p">(</span><span class="n">sym</span><span class="p">)));</span>
<span class="p">}</span>
<span class="c1">//...</span>
<span class="n">rb_define_method</span><span class="p">(</span><span class="n">rb_cSymbol</span><span class="p">,</span> <span class="s">"empty?"</span><span class="p">,</span> <span class="n">sym_empty</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span></code></pre></figure>

<p>Finally, looking at the function for <code class="language-plaintext highlighter-rouge">Symbol#empty?</code> we start to see why it works the way it does.  The short answer is that it simply casts the symbol to a string before checking whether it is empty.  But this has a few implecations to it.  First casting a symbol to a string atomatically increases the memory allocation for the variable.  It’s also worth noting that casting a symbol actually requires a chain of function calls.  First the symbol’s value must be retrieved from the global symbol table.  This is what <code class="language-plaintext highlighter-rouge">SYM2ID</code> is doing.  Next that value is cast to a string, and finally the strings memory allocations is counted.</p>

<p>In the grand scheme of things none of this is particularly costly, but it is enlightening to see what is actually going on behind the scenes.</p>

</p>
    </article>
    <br />
    <hr >
    <br />
  
    <article itemscope itemtype="http://schema.org/BlogPosting" itemprop="blogPost" class="listed_article">
      <h2 class="listed_headline" temprop="headline"><a href="/the-lesser-known-contributors-who-are-trying-to-ma" rel="bookmark" title="The Lesser-Known Contributors Who Are Trying To Make PHP Good Again">The Lesser-Known Contributors Who Are Trying To Make PHP Good Again</a></h2>
      <small class="article_date">02 Oct 2012</small><br /><br />
      <p itemprop="text"><p>Php gets a log of hate, and a lot of that hate is <a href="http://php.net/manual/en/types.comparisons.php">not</a> <a href="http://me.veekun.com/blog/2012/04/09/php-a-fractal-of-bad-design/">without</a> <a href="http://www.codinghorror.com/blog/2012/06/the-php-singularity.html">merit</a>.  But I have recently started adopting some tools at work that make php development a lot more enjoyable, and thought I would share.</p>

<h4 id="1-composer">1) Composer:</h4>

<p>Composer is a pretty great package management system in the style of npm.  It provides package management at the project level by providing a autoloader that is compiled on package install.  This allows developers the ability to have multiple package versions installed on one machine and have them mapped to the projects they are specified for.</p>

<p>Furthermore, composer allows package maintainers a fresh start from the mess that is the Pear package manager.</p>

<p>A projects dependencies can be set up simply by including a composer.phar file and setting up a composer.json file like so:</p>

<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="w">  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"My-New-Project"</span><span class="p">,</span><span class="w">

    </span><span class="nl">"require-prod"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"doctrine/orm"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2.2.1"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"require-dev"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"doctrine/orm"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2.*"</span><span class="w">

    </span><span class="nl">"require"</span><span class="p">:{</span><span class="w">
        </span><span class="nl">"facebook-sdk"</span><span class="p">:</span><span class="w"> </span><span class="s2">"master"</span><span class="w">
    </span><span class="p">},</span><span class="w">

    </span><span class="nl">"repositories"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"package"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"facebook-sdk"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"master"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"source"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nl">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://github.com/facebook/php-sdk.git"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"git"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"reference"</span><span class="p">:</span><span class="w"> </span><span class="s2">"master"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">

  </span><span class="p">}</span></code></pre></figure>

<h4 id="2-phake">2) Phake:</h4>

<p>One of the major reasons that ruby and python have become tremendously popular over the past five to ten years is because they provide very easy paths to test drive and maintain high coverage of your code base.  The same cannot be said for PHP and its PhpUnit framework.</p>

<p>Phake is a mocking framework that aims to fix a lot of the problems that PhpUnit’s mocking framework introduces.</p>

<p>Simple mocking and stubbing in Phake has far less unnecessarily verbosity.  Where a mock in PhpUnit requires this:</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php">  <span class="cp">&lt;?php</span>
  <span class="nv">$mock</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">getMockBuilder</span><span class="p">(</span><span class="s1">'MyClass'</span><span class="p">)</span>
      <span class="o">-&gt;</span><span class="nf">disableOriginalConstructor</span><span class="p">()</span>
      <span class="o">-&gt;</span><span class="nf">setMethods</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">'some_method'</span><span class="p">))</span>
      <span class="o">-&gt;</span><span class="nf">getMock</span><span class="p">();</span>

  <span class="nv">$mock</span><span class="o">-&gt;</span><span class="nf">expects</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">any</span><span class="p">())</span>
      <span class="o">-&gt;</span><span class="nf">method</span><span class="p">(</span><span class="s1">'some_method'</span><span class="p">)</span>
      <span class="o">-&gt;</span><span class="nf">with</span><span class="p">(</span><span class="s1">'some_value'</span><span class="p">)</span>
      <span class="o">-&gt;</span><span class="nf">will</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">returnValue</span><span class="p">(</span><span class="s1">'something'</span><span class="p">));</span>
  <span class="cp">?&gt;</span></code></pre></figure>

<p>Phake only requires this:</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php">  <span class="cp">&lt;?php</span>
  <span class="nv">$mock</span> <span class="o">=</span> <span class="nc">Phake</span><span class="o">::</span><span class="nf">mock</span><span class="p">(</span><span class="s1">'MyClass'</span><span class="p">);</span>
  <span class="nc">Phake</span><span class="o">::</span><span class="nf">when</span><span class="p">(</span><span class="nv">$mock</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">someMethod</span><span class="p">(</span><span class="s1">'expected value'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">thenReturn</span><span class="p">(</span><span class="s1">'something'</span><span class="p">);</span>
  <span class="cp">?&gt;</span></code></pre></figure>

<p>Additionally, Phake provides a more sane solution to running verifies.  In phpunit’s verify system you are required to state your verify before you state the code you’re testing.  This makes the test much harder to read.</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php">  <span class="cp">&lt;?php</span>
  <span class="nv">$mock</span><span class="o">-&gt;</span><span class="nf">expects</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">any</span><span class="p">())</span>
    <span class="o">-&gt;</span><span class="nf">method</span><span class="p">(</span><span class="s1">'some_method'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">with</span><span class="p">(</span><span class="s1">'some_value'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">will</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">returnValue</span><span class="p">(</span><span class="s1">'something'</span><span class="p">));</span>

  <span class="nv">$tested_class</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">TestedClass</span><span class="p">();</span>
  <span class="nv">$tested_class</span><span class="o">-&gt;</span><span class="nf">setMock</span><span class="p">(</span><span class="nv">$mock</span><span class="p">);</span>
  <span class="nv">$tested_class</span><span class="o">-&gt;</span><span class="nf">methodThatCallsMockedMethod</span><span class="p">(</span><span class="s1">'some_value'</span><span class="p">);</span>
  <span class="cp">?&gt;</span></code></pre></figure>

<p>In Phake you are able to verify after your mock is injected like so:</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php">  <span class="cp">&lt;?php</span>
  <span class="nv">$mock</span> <span class="o">=</span> <span class="nc">Phake</span><span class="o">::</span><span class="nf">mock</span><span class="p">(</span><span class="s1">'MyClass'</span><span class="p">);</span>
  <span class="nv">$mock</span><span class="o">-&gt;</span><span class="nf">someMethod</span><span class="p">(</span><span class="s1">'some_value'</span><span class="p">);</span>

  <span class="nv">$tested_class</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">TestedClass</span><span class="p">();</span>
  <span class="nv">$tested_class</span><span class="o">-&gt;</span><span class="nf">setMock</span><span class="p">(</span><span class="nv">$mock</span><span class="p">);</span>

  <span class="c1">//verify after calling the code being tested.</span>
  <span class="nc">Phake</span><span class="o">::</span><span class="nf">verify</span><span class="p">(</span><span class="nv">$mock</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">someMethod</span><span class="p">(</span><span class="s1">'some_value'</span><span class="p">);</span>
  <span class="cp">?&gt;</span></code></pre></figure>

<h4 id="3-php-54-additions">3) Php 5.4 Additions:</h4>

<p>There are several additions that have been made to php in 5.4 that provide tools that I am use to having access to in other web development environments.  Namely, short syntax arrays, method chaining directly from an instantiated object and building a web server on the fly.  Try some of these commands out:</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php">  <span class="cp">&lt;?php</span>
  <span class="c1">//new array syntax</span>
  <span class="nv">$my_array</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="s1">'a'</span><span class="p">,</span> <span class="mi">299</span><span class="p">,</span> <span class="s1">'hello'</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="s1">'world'</span><span class="p">];</span>

  <span class="c1">//chain off object instantiation</span>
  <span class="nv">$my_class</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MyClass</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">someMethod</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">someOtherMethod</span><span class="p">();</span>

  <span class="c1">//instantiate a webserver from the command line</span>
  <span class="n">php</span> <span class="o">-</span><span class="nc">S</span> <span class="n">localhost</span><span class="o">:</span><span class="mi">8000</span>

  <span class="c1">//instantiate a webserver with webroot defined</span>
  <span class="n">php</span> <span class="o">-</span><span class="nc">S</span> <span class="n">localhost</span><span class="o">:</span><span class="mi">8000</span> <span class="o">-</span><span class="n">t</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">your</span><span class="o">/</span><span class="n">files</span>
  <span class="cp">?&gt;</span></code></pre></figure>

<p>Php still has its faults and there is likely little that can be done to erase them.  But the developers of these new tools deserve some serious recognition for the work they are doing to move a language they love in the right direction.</p>

</p>
    </article>
    <br />
    <hr >
    <br />
  
    <article itemscope itemtype="http://schema.org/BlogPosting" itemprop="blogPost" class="listed_article">
      <h2 class="listed_headline" temprop="headline"><a href="/how-i-make-django-easier" rel="bookmark" title="How I Make Django Easier">How I Make Django Easier</a></h2>
      <small class="article_date">23 Sep 2012</small><br /><br />
      <p itemprop="text"><p>Everyone who has worked with Django for any reasonable period of time comes to the realization that starting up a new project can be a pain in the butt if you don’t build some level of automation into the process.  After a few times copy and pasting into your &lt;pre&gt;settings.py&lt;/pre&gt; most developers decide they can’t handle it any more and write some scripts to take care of the setup process for them.</p>

<p>I thought I would share my setup script, recently modified, and hopefully it will be helpful to those who are still in copy and past land.</p>

<p>First, my basic setup for most django projects I start is as follows:</p>

<p>1)   create a new virtual environment with <a href="https://pypi.python.org/pypi/virtualenv">virtualenv</a></p>

<p>2)   install django within the environment and start a new project</p>

<p>3)   remove database setup, static media setup and debug settings from the auto generated settings.py file.</p>

<p>4)   Add debug_toolbar settings, a dynamic media path, dynamic template_dir path,  django_evolution or south and an import of a settings_local.py file to the settings.py file.</p>

<p>5)   Create a settings_local.py file that defines local database connection, static media path and debug settings.</p>

<p>6)   Modify the urls.py file to handle your static and media directories correctly.</p>

<p>7)   Create a new sublime text project containing the new django project.</p>

<p>8)   Initialize the django project as a git repo  and create a .gitignore file.</p>

<p>9)   Create a deploy script to ssh into production and git pull from github.</p>

<p>10)  Get started actually building my app</p>

<p>Do this once or twice and you start to understand why many prefer customization over configuration.  But if you’re a Django lover like myself you find a way around it.</p>

<p>So I built this quick and dirty script to do all of this for me:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python">  <span class="kn">import</span> <span class="nn">subprocess</span><span class="p">,</span> <span class="n">os</span><span class="p">,</span> <span class="n">sys</span><span class="p">,</span> <span class="n">re</span>
  <span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">choice</span>
  <span class="kn">from</span> <span class="nn">git</span> <span class="kn">import</span> <span class="o">*</span>
  <span class="kn">from</span> <span class="nn">django_create</span> <span class="kn">import</span> <span class="o">*</span>

  <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
      <span class="c1">#variable declarations
</span>      <span class="n">starting_path</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">getcwd</span><span class="p">()</span>
      <span class="n">templates_path</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">__file__</span><span class="p">))</span> <span class="o">+</span> <span class="s">'/templates'</span>
      <span class="n">project_name</span> <span class="o">=</span> <span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

      <span class="n">create_virtualenv</span><span class="p">(</span><span class="n">project_name</span><span class="p">)</span>
      <span class="n">create_django_project</span><span class="p">(</span><span class="n">project_name</span><span class="p">,</span> <span class="n">starting_path</span><span class="p">)</span>
      <span class="n">create_settings_file</span><span class="p">(</span><span class="n">project_name</span><span class="p">,</span> <span class="n">starting_path</span><span class="p">,</span> <span class="n">templates_path</span><span class="p">)</span>
      <span class="n">create_secret_key</span><span class="p">()</span>
      <span class="n">create_local_settings_file</span><span class="p">(</span><span class="n">project_name</span><span class="p">,</span> <span class="n">templates_path</span><span class="p">)</span>
      <span class="n">create_other_files</span><span class="p">(</span><span class="n">project_name</span><span class="p">,</span> <span class="n">starting_path</span><span class="p">)</span>
      <span class="n">create_git_repo</span><span class="p">(</span><span class="n">project_name</span><span class="p">,</span> <span class="n">starting_path</span><span class="p">,</span> <span class="n">templates_path</span><span class="p">)</span>
      <span class="n">create_deploy_script</span><span class="p">(</span><span class="n">project_name</span><span class="p">,</span> <span class="n">starting_path</span><span class="p">,</span> <span class="n">templates_path</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">create_virtualenv</span><span class="p">(</span><span class="n">project_name</span><span class="p">):</span>
      <span class="n">subprocess</span><span class="p">.</span><span class="n">call</span><span class="p">([</span><span class="s">'virtualenv'</span><span class="p">,</span> <span class="n">project_name</span><span class="p">])</span>

  <span class="k">def</span> <span class="nf">create_django_project</span><span class="p">(</span><span class="n">project_name</span><span class="p">,</span> <span class="n">starting_path</span><span class="p">):</span>
      <span class="n">os</span><span class="p">.</span><span class="n">chdir</span><span class="p">(</span><span class="s">'/'</span><span class="p">.</span><span class="n">join</span><span class="p">([</span><span class="n">starting_path</span><span class="p">,</span> <span class="n">project_name</span><span class="p">]))</span>
      <span class="n">subprocess</span><span class="p">.</span><span class="n">call</span><span class="p">([</span><span class="s">'source'</span><span class="p">,</span> <span class="s">'bin/activate'</span><span class="p">])</span>
      <span class="n">subprocess</span><span class="p">.</span><span class="n">call</span><span class="p">([</span><span class="s">'bin/pip'</span><span class="p">,</span> <span class="s">'install'</span><span class="p">,</span> <span class="s">'django'</span><span class="p">])</span>
      <span class="n">subprocess</span><span class="p">.</span><span class="n">call</span><span class="p">([</span><span class="s">'django-admin.py'</span><span class="p">,</span> <span class="s">'startproject'</span><span class="p">,</span> <span class="n">project_name</span><span class="p">])</span>

  <span class="k">def</span> <span class="nf">create_settings_file</span><span class="p">(</span><span class="n">project_name</span><span class="p">,</span> <span class="n">starting_path</span><span class="p">,</span> <span class="n">templates_path</span><span class="p">):</span>
      <span class="k">print</span> <span class="s">'Creating custom settings.py file'</span>
      <span class="n">os</span><span class="p">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">starting_path</span> <span class="o">+</span> <span class="s">'/'</span> <span class="o">+</span> <span class="n">project_name</span> <span class="o">+</span> <span class="s">'/'</span> <span class="o">+</span> <span class="n">project_name</span><span class="p">)</span>
      <span class="n">settings_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'settings.py'</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span>
      <span class="n">settings_template</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">templates_path</span> <span class="o">+</span> <span class="s">'/settings.py'</span><span class="p">)</span>
      <span class="n">settings_file</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">settings_template</span><span class="p">.</span><span class="n">read</span><span class="p">().</span><span class="n">replace</span><span class="p">(</span><span class="s">''</span><span class="p">,</span> <span class="n">project_name</span><span class="p">))</span>
      <span class="n">settings_file</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>

  <span class="k">def</span> <span class="nf">create_secret_key</span><span class="p">():</span>
      <span class="k">print</span><span class="s">'Creating secret key'</span>
      <span class="n">settings_contents</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'settings.py'</span><span class="p">,</span> <span class="s">'r'</span><span class="p">).</span><span class="n">read</span><span class="p">()</span>
      <span class="n">fp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'settings.py'</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span>
      <span class="n">secret_key</span> <span class="o">=</span> <span class="s">''</span><span class="p">.</span><span class="n">join</span><span class="p">([</span><span class="n">choice</span><span class="p">(</span><span class="s">'abcdefghijklmnopqrstuvwxyz0123456789!@#$%^&amp;*(-_=+)'</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">)])</span>
      <span class="n">settings_contents</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s">"(?&lt;=SECRET_KEY = ')'"</span><span class="p">,</span> <span class="n">secret_key</span> <span class="o">+</span> <span class="s">"'"</span><span class="p">,</span> <span class="n">settings_contents</span><span class="p">)</span>
      <span class="n">fp</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">settings_contents</span><span class="p">)</span>
      <span class="n">fp</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>

  <span class="k">def</span> <span class="nf">create_local_settings_file</span><span class="p">(</span><span class="n">project_name</span><span class="p">,</span> <span class="n">templates_path</span><span class="p">):</span>
      <span class="k">print</span> <span class="s">'Creating custom settings_local.py file'</span>
      <span class="n">settings_local_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'settings_local.py'</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span>
      <span class="n">settings_local_template</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">templates_path</span> <span class="o">+</span> <span class="s">'/settings_local.py'</span><span class="p">)</span>
      <span class="n">settings_local_file</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">settings_local_template</span><span class="p">.</span><span class="n">read</span><span class="p">().</span><span class="n">replace</span><span class="p">(</span><span class="s">''</span><span class="p">,</span> <span class="n">project_name</span><span class="p">))</span>
      <span class="n">settings_local_file</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>

  <span class="k">def</span> <span class="nf">create_other_files</span><span class="p">(</span><span class="n">project_name</span><span class="p">,</span> <span class="n">starting_path</span><span class="p">):</span>
      <span class="k">print</span> <span class="s">'Creating Sublime Text project files'</span>
      <span class="n">os</span><span class="p">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">starting_path</span> <span class="o">+</span> <span class="s">'/'</span> <span class="o">+</span> <span class="n">project_name</span><span class="p">)</span>
      <span class="n">sublimetext_project</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">project_name</span> <span class="o">+</span> <span class="s">'.sublime-project'</span><span class="p">,</span> <span class="s">'w'</span><span class="p">).</span><span class="n">write</span><span class="p">(</span><span class="s">'{"folders": [{"path": "'</span> <span class="o">+</span> <span class="n">project_name</span> <span class="o">+</span> <span class="s">'"}]}'</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">create_git_repo</span><span class="p">(</span><span class="n">project_name</span><span class="p">,</span> <span class="n">starting_path</span><span class="p">,</span> <span class="n">templates_path</span><span class="p">):</span>
      <span class="n">repo</span> <span class="o">=</span> <span class="n">Repo</span><span class="p">.</span><span class="n">init</span><span class="p">(</span><span class="s">''</span><span class="p">.</span><span class="n">join</span><span class="p">([</span><span class="n">starting_path</span><span class="p">,</span> <span class="s">'/'</span><span class="p">,</span> <span class="n">project_name</span><span class="p">,</span> <span class="s">'/'</span><span class="p">,</span> <span class="n">project_name</span><span class="p">]))</span>
      <span class="n">git_ignore</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">starting_path</span> <span class="o">+</span> <span class="s">'/'</span> <span class="o">+</span> <span class="n">project_name</span> <span class="o">+</span> <span class="s">'/'</span> <span class="o">+</span> <span class="n">project_name</span> <span class="o">+</span> <span class="s">'/.gitignore'</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span>
      <span class="n">git_ignore_contents</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">templates_path</span> <span class="o">+</span> <span class="s">'/.gitignore'</span><span class="p">).</span><span class="n">read</span><span class="p">()</span>
      <span class="n">git_ignore</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">git_ignore_contents</span><span class="p">)</span>
      <span class="n">git_ignore</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>

  <span class="k">def</span> <span class="nf">create_deploy_script</span><span class="p">(</span><span class="n">project_name</span><span class="p">,</span> <span class="n">starting_path</span><span class="p">,</span> <span class="n">templates_path</span><span class="p">):</span>
      <span class="k">print</span> <span class="s">'Creating remote deploy script'</span>
      <span class="n">os</span><span class="p">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">starting_path</span> <span class="o">+</span> <span class="s">'/'</span> <span class="o">+</span> <span class="n">project_name</span> <span class="o">+</span> <span class="s">'/'</span> <span class="o">+</span> <span class="n">project_name</span><span class="p">)</span>
      <span class="n">deploy_script</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'deploy.sh'</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span>
      <span class="n">deploy_contents</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">templates_path</span> <span class="o">+</span> <span class="s">'/deploy.sh'</span><span class="p">,</span> <span class="s">'r'</span><span class="p">).</span><span class="n">read</span><span class="p">().</span><span class="n">replace</span><span class="p">(</span><span class="s">''</span><span class="p">,</span> <span class="n">project_name</span><span class="p">)</span>
      <span class="n">deploy_script</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">deploy_contents</span><span class="p">)</span>
      <span class="n">deploy_script</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
      <span class="n">subprocess</span><span class="p">.</span><span class="n">call</span><span class="p">(</span><span class="s">'chmod 700 deploy.sh'</span><span class="p">)</span>

  <span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
      <span class="n">main</span><span class="p">()</span></code></pre></figure>

<p>This calls to a templates directory that has a settings.py settings_local.py and deploy.sh templates.</p>

<p>A few other things to note: most actions are called as subprocesses directly to the command line rather than using wrapper libraries primarily out of laziness.  When replacing the settings file it is important to remember to regenerate the secrete_key.  The deploy script is not an integration script.  For most of my personal projects I run tests locally and push to github for integration.</p>

<p>If you want to use this script or something similar simply clone <a href="https://github.com/DanielNill/django_create">https://github.com/DanielNill/django_create</a> and modify as you like.</p>
</p>
    </article>
    <br />
    <hr >
    <br />
  
    <article itemscope itemtype="http://schema.org/BlogPosting" itemprop="blogPost" class="listed_article">
      <h2 class="listed_headline" temprop="headline"><a href="/nodejs-tutorial-with-socketio" rel="bookmark" title="Node.js Tutorial With Socket.io">Node.js Tutorial With Socket.io</a></h2>
      <small class="article_date">28 Jul 2012</small><br /><br />
      <p itemprop="text"><h4 id="update-this-tutorial-has-been-update-to-run-on-node-500-and-socketio-137--if-you-have-trouble-with-getting-the-code-to-execute-make-sure-you-are-running-on-these-versions">Update: this tutorial has been update to run on node 5.0.0 and socket.io 1.3.7.  If you have trouble with getting the code to execute, make sure you are running on these versions.</h4>

<p>I was shocked to recently discover that there are no great quick tutorial on the basics of using socket.io with node js.  While there isn’t a whole lot to it, someone not familiar with node.js and the protocol for WebSockets is left to scrounge for random snippets of code.  Trying to parse the protocol of Websockets while learning the socket.io library and the basics of Node.js all at the same time is no easy feat.  And even more frustrating, someone new to Node.js is likely interested in trying it out for the features socket.io provide.</p>

<p>So I thought I would take a brief stab at filling this void. Lets get started:</p>

<h3 id="what-we-will-cover">What We Will Cover:</h3>

<p>In this tutorial we will cover</p>

<ul>
  <li>setting up a Node.js server and router (You can find this many places but it is a necessary first step)</li>
  <li>connecting socket.io to this server</li>
  <li>sending data to the client through the socket connection</li>
  <li>sending data to the server through the socket connection</li>
</ul>

<h4 id="your-basic-server">Your Basic Server:</h4>

<p>There are several modules you can use to initiate a server in Node.js, but they are all pretty much the same.  We will use the http library.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript">    <span class="kd">var</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">http</span><span class="dl">'</span><span class="p">);</span>

    <span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">();</span>
    <span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">8001</span><span class="p">);</span></code></pre></figure>

<p>With these 3 lines we have a server. You can save this as <code class="language-plaintext highlighter-rouge">server.js</code> and run <code class="language-plaintext highlighter-rouge">node server.js</code> and you will see your command line ‘stall’ on the process waiting for something to happen on the server. But that’s just it, a server that doesn’t do anything isn’t any fun.  So lets have it do something:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript">    <span class="kd">var</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">http</span><span class="dl">'</span><span class="p">);</span>

    <span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">){</span>
        <span class="nx">response</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="p">{</span><span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">text/html</span><span class="dl">'</span><span class="p">});</span>
        <span class="nx">response</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="dl">'</span><span class="s1">hello world</span><span class="dl">'</span><span class="p">);</span>
        <span class="nx">response</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
    <span class="p">});</span>

    <span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">8001</span><span class="p">);</span></code></pre></figure>

<p>With these changes we are now sending something to the client.  Save <code class="language-plaintext highlighter-rouge">server.js</code> and run <code class="language-plaintext highlighter-rouge">node server.js</code> .  Still nothing happens, but if we go to <a href="http://localhost:8001">http://localhost:8001</a> we see a page that says “hello world”!</p>

<p>The actions we put inside createServer will be executed each time <a href="http://localhost:8001">http://localhost:8001</a> is loaded.  Lets slow down and go through what we did line by line.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">){});</span>
<span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">8001</span><span class="p">);</span></code></pre></figure>

<p>Here we have created the server just as we had the first time, but now we are passing it an anonymous function that defines what happens with each request to the server and response from the server.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">){</span>
    <span class="c1">//...</span>
<span class="p">});</span></code></pre></figure>

<p>Here we simply say on every request response interaction with the server we will take some action.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript">    <span class="nx">response</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="p">{</span><span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">text/html</span><span class="dl">'</span><span class="p">});</span></code></pre></figure>

<p>Here we define how we are sending data to the client.  All elements declared by <code class="language-plaintext highlighter-rouge">writeHead</code> are written to the response header.  Our <code class="language-plaintext highlighter-rouge">writeHead</code> describes the HTTP Code of the response and the content type.  The content type can be any of the common MIME types.  You can define several other elements found in the HTTP response header, but we won’t worry about that for this tutorial.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">response</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="dl">'</span><span class="s1">hello world</span><span class="dl">'</span><span class="p">);</span></code></pre></figure>

<p>This defines the actual contents of our response.  More precicely it defines the action of the response.  Write says the the contents of the response is “hello world” and upon executing the response the server will append that content to the document being served.</p>

<p>Finally we have</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript">    <span class="nx">response</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span></code></pre></figure>

<p>This simply says that we are done defining the response and action and executes them.</p>

<h4 id="creating-the-router">Creating The Router:</h4>

<p>So now we have very basic server, but it can only server our root domain.  Lets fix that.  We add the following to <code class="language-plaintext highlighter-rouge">server.js</code>.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript">    <span class="kd">var</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">http</span><span class="dl">"</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">url</span><span class="dl">'</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">fs</span><span class="dl">'</span><span class="p">);</span>

    <span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">){</span>
        <span class="kd">var</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">url</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">url</span><span class="p">).</span><span class="nx">pathname</span><span class="p">;</span>

        <span class="k">switch</span><span class="p">(</span><span class="nx">path</span><span class="p">){</span>
            <span class="k">case</span> <span class="dl">'</span><span class="s1">/</span><span class="dl">'</span><span class="p">:</span>
                <span class="nx">response</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="p">{</span><span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">text/html</span><span class="dl">'</span><span class="p">});</span>
                <span class="nx">response</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="dl">'</span><span class="s1">hello world</span><span class="dl">'</span><span class="p">);</span>
                <span class="nx">response</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="dl">'</span><span class="s1">/socket.html</span><span class="dl">'</span><span class="p">:</span>
                <span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="nx">__dirname</span> <span class="o">+</span> <span class="nx">path</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">data</span><span class="p">){</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">){</span>
                        <span class="nx">response</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">404</span><span class="p">);</span>
                        <span class="nx">response</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="dl">"</span><span class="s2">opps this doesn't exist - 404</span><span class="dl">"</span><span class="p">);</span>
                        <span class="nx">response</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
                    <span class="p">}</span>
                    <span class="k">else</span><span class="p">{</span>
                        <span class="nx">response</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="p">{</span><span class="dl">"</span><span class="s2">Content-Type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">text/html</span><span class="dl">"</span><span class="p">});</span>
                        <span class="nx">response</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="dl">"</span><span class="s2">utf8</span><span class="dl">"</span><span class="p">);</span>
                        <span class="nx">response</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
                    <span class="p">}</span>
                <span class="p">});</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="nl">default</span><span class="p">:</span>
                <span class="nx">response</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">404</span><span class="p">);</span>
                <span class="nx">response</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="dl">"</span><span class="s2">opps this doesn't exist - 404</span><span class="dl">"</span><span class="p">);</span>
                <span class="nx">response</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
                <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">});</span>

    <span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">8001</span><span class="p">);</span></code></pre></figure>

<p>If you save this code as <code class="language-plaintext highlighter-rouge">server.js</code> you can rerun <code class="language-plaintext highlighter-rouge">node server.js</code> when you load <a href="http://localhost:8001">http://localhost:8001</a> into your browser you will see that nothing has changed.  We still get “hello world” in the browser.  However, we just build a router so now we should be able to go other urls.  Looking at the code we just wrote it seems like we should be able to visit <a href="http://localhost:8001/socket.html">http://localhost:8001/socket.html</a> and something should happen.  But when we try that we get our 404 message.  Lets go through what we added and see why.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">url</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">fs</span><span class="dl">'</span><span class="p">);</span></code></pre></figure>

<p>Here we have added two new modules, <code class="language-plaintext highlighter-rouge">url</code> and <code class="language-plaintext highlighter-rouge">fs</code>.  <code class="language-plaintext highlighter-rouge">url</code> is used to to parse interpret and manipulate urls, you can learn more about it <a href="http://nodejs.org/docs/v0.3.1/api/url.html">here</a>.  <code class="language-plaintext highlighter-rouge">fs</code> is used to handle files, you can read about it <a href="http://nodejs.org/api/fs.html">here</a>.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">url</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">url</span><span class="p">).</span><span class="nx">pathname</span><span class="p">;</span></code></pre></figure>

<p>With this line we get the path that follows our root domain.  So <code class="language-plaintext highlighter-rouge">localhost:8001</code> will assign ‘/’ to path and <code class="language-plaintext highlighter-rouge">localhost:8001/some_other_path</code> will assign ‘some_other_path’ to path.  You can test this by adding <code class="language-plaintext highlighter-rouge">console.log(path)</code> immediately after this line.</p>

<p>Next we perform a switch case on the path to decide what we want the server to do.  If the path is root then we perform our hello world action.  If the path is socket.html then the server performs a different action.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="nx">__dirname</span> <span class="o">+</span> <span class="nx">path</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">data</span><span class="p">){...});</span></code></pre></figure>

<p>Here we use the fs module to open the file that is on the path the server recieves.  Like most methods in node.js readFile takes a callback function to define its action. This function defines the action we want taken once the file’s contents have been gathered.  In this case we are wanting to get the file socket.html.  At this point you have probably noticed why we were getting that 404 message, socket.html doesn’t exist!!!</p>

<p>Let’s go through the rest of our changes and then we will solve that problem.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">){</span>
    <span class="nx">response</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">404</span><span class="p">);</span>
    <span class="nx">response</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="dl">"</span><span class="s2">opps this doesn't exist - 404</span><span class="dl">"</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>

<p>The first argument we pass to the readFile callback contains the error code if we are unable to open the file (like say it doesn’t exist).  The second variable passed is the contents of the file if we are able to open it.  So we say that if there is an error opening the file on the path then we return a 404 header and write a message to the returned document.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="k">else</span><span class="p">{</span>
    <span class="nx">response</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="p">{</span><span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">text/html</span><span class="dl">'</span><span class="p">});</span>
    <span class="nx">response</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="dl">'</span><span class="s1">utf8</span><span class="dl">'</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>

<p>Here is what we want to happen once we have a readable file.  It’s the same as what we do when we route to ‘/’ but instead we write the contents of the document we read and encode it as utf8.</p>

<p>You will also want to note that we still call <code class="language-plaintext highlighter-rouge">response.end()</code> at the bottom of our createServer function so that whatever actions are routed to the response object are closed and executed.</p>

<p>Now that we see why we are getting that 404 lets fix it.  Lets create a new page where we will use socket.io</p>

<h4 id="adding-socketio">Adding Socket.io:</h4>

<p>To start with we want to get rid of the 404 error when we visit http://localhost:8001/socket.html so we are going to create a socket.html file.</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>This is our socket.html file<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span></code></pre></figure>

<p>Now we save this to the same directory as our server.js file and run <code class="language-plaintext highlighter-rouge">node server.js</code>.  Now when we go to <a href="http://localhost:8001/socket.html">http://localhost:8001/socket.html</a> we should see a page with “This is our socket.html file”.</p>

<p>That’s great but that’s not really what we’re here for.  So let’s get into the real bread and butter, Socket.io!</p>

<p>First we will instantiate socket.io and extend it from our server.  We change our server.js file to look like this:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">http</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">url</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">fs</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">io</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">socket.io</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">url</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">url</span><span class="p">).</span><span class="nx">pathname</span><span class="p">;</span>

    <span class="k">switch</span><span class="p">(</span><span class="nx">path</span><span class="p">){</span>
        <span class="k">case</span> <span class="dl">'</span><span class="s1">/</span><span class="dl">'</span><span class="p">:</span>
            <span class="nx">response</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="p">{</span><span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">text/html</span><span class="dl">'</span><span class="p">});</span>
            <span class="nx">response</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="dl">'</span><span class="s1">hello world</span><span class="dl">'</span><span class="p">);</span>
            <span class="nx">response</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="dl">'</span><span class="s1">/socket.html</span><span class="dl">'</span><span class="p">:</span>
            <span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="nx">__dirname</span> <span class="o">+</span> <span class="nx">path</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">data</span><span class="p">){</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">){</span>
                    <span class="nx">response</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">404</span><span class="p">);</span>
                    <span class="nx">response</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="dl">"</span><span class="s2">opps this doesn't exist - 404</span><span class="dl">"</span><span class="p">);</span>
                    <span class="nx">response</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
                <span class="p">}</span>
                <span class="k">else</span><span class="p">{</span>
                    <span class="nx">response</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="p">{</span><span class="dl">"</span><span class="s2">Content-Type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">text/html</span><span class="dl">"</span><span class="p">});</span>
                    <span class="nx">response</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="dl">"</span><span class="s2">utf8</span><span class="dl">"</span><span class="p">);</span>
                    <span class="nx">response</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
                <span class="p">}</span>
            <span class="p">});</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="nl">default</span><span class="p">:</span>
            <span class="nx">response</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">404</span><span class="p">);</span>
            <span class="nx">response</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="dl">"</span><span class="s2">opps this doesn't exist - 404</span><span class="dl">"</span><span class="p">);</span>
            <span class="nx">response</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
            <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">8001</span><span class="p">);</span>

<span class="nx">io</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">server</span><span class="p">);</span></code></pre></figure>

<p>All we have added here is a require for the socket.io module at the top and the line <code class="language-plaintext highlighter-rouge">io.listen(server);</code>.  This simply says that when the server is instantiated (note: not connected to) we will open a listener for socket.io.  This means that our server will ‘listen’ for pages loaded by the server that have a WebSocket connection instantiated on them.</p>

<p>So lets see what happens when we run node server.js and reload <a href="http://localhost:8001/socket.html">http://localhost:8001/socket.html</a>.  Nothing seems to change in the browser but our server is now listening for any websocket connections that may occur.</p>

<p>Now that the server is listening for socket.io connections lets give our socket.html page a WebSockets connection so that the server will actually have something to talk to.  To do this we simple change socket.html to:</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"/socket.io/socket.io.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;script&gt;</span>
      <span class="kd">var</span> <span class="nx">socket</span> <span class="o">=</span> <span class="nx">io</span><span class="p">.</span><span class="nx">connect</span><span class="p">();</span>
    <span class="nt">&lt;/script&gt;</span>
    <span class="nt">&lt;div&gt;</span>This is our socket.html file<span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span></code></pre></figure>

<p>Here we have added the socket.io.js script and a body script to create the client side socket connection. Now we have a WebSockets connection between the client and our server.  Let’s try sending some information from the server to the client through our socket.io connection</p>

<h4 id="sending-data-to-the-client">Sending Data To The Client:</h4>

<p>Now we want to send some data from the server to socket.html.  All data transactions in socket.io, like in most of node.js, can be handled with callbacks primarily we will utilize the <code class="language-plaintext highlighter-rouge">on</code> method.  The on method in simplistic terms is used to map a method name to an annonymous function.  Because we are using socket.io the on method simply uses the listener on the websocket connection for the method name and when it is found it executes the mapped annonymous function.</p>

<p>The flip side of the on method is the emit method.  The emit method sends the mapped method name to the client or the server.  It takes two arguments.  The mapped method name and the data to be fed to the annonymous function.</p>

<p>So here is what we add to server.js:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">listener</span> <span class="o">=</span> <span class="nx">io</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">server</span><span class="p">);</span>
<span class="nx">listener</span><span class="p">.</span><span class="nx">sockets</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">connection</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">socket</span><span class="p">){</span>
    <span class="nx">socket</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="dl">'</span><span class="s1">message</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span><span class="dl">'</span><span class="s1">message</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">hello world</span><span class="dl">'</span><span class="p">});</span>
<span class="p">});</span></code></pre></figure>

<p>All we are saying here is when the listener gets a call for the “connection” action we will perform the function that follows it.  When the “connection” action is called we trigger an emit action that will send a “message” action to the client.  The “message” action will send the json object {‘message’: ‘hello world’} .</p>

<p>The ‘connection’ action is triggered when io.connection(); is executed on socket.html.  Socket.io has several build in mappable actions, but we can also create custom mappable actions as we will see shortly.</p>

<p>To retrieve the emitted “message” action on socket.html we just add an on method listener:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">socket</span> <span class="o">=</span> <span class="nx">io</span><span class="p">.</span><span class="nx">connect</span><span class="p">();</span>

<span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">message</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">){</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
<span class="p">});</span></code></pre></figure>

<p>Now we have an emit on the server side that sends data to the client side.  And an on method on the client side that recieves that data and writes it to the browser’s console.  Run node server.js again and reload the page.  If you open up the javascript console of your browser you will note that “hello world” has been written.  Further more, if you check your command line you will note that you have more debug statements from socket.io explaining the transmission and contents of the message.</p>

<p>But we could just as easily produce this content through a normal page load or ajax call.  We want the actions transmitted through our socket connection to be continuous.  A good example of this is a clock. A clock updates the data it displays literally every second.</p>

<p>So lets do that.  In javascript we can create repeatable actions with the setInterval function.  setInterval takes an anonymous function and a number of miliseconds as arguments and executes the function every count of the miliseconds.  So if you want to print hello world every one second you would simply say</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">setInterval</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">hello world</span><span class="dl">'</span><span class="p">);</span>
<span class="p">},</span> <span class="mi">1000</span><span class="p">);</span></code></pre></figure>

<p>So going back to our server.js file we want to emit data for our clock through our socket connection.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">io</span><span class="p">.</span><span class="nx">sockets</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">connection</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">socket</span><span class="p">){</span>
    <span class="c1">//send data to client</span>
    <span class="nx">setInterval</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
        <span class="nx">socket</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="dl">'</span><span class="s1">date</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span><span class="dl">'</span><span class="s1">date</span><span class="dl">'</span><span class="p">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">()});</span>
    <span class="p">},</span> <span class="mi">1000</span><span class="p">);</span>
<span class="p">});</span></code></pre></figure>

<p>We are doing a few things here.  First we set up our setInterval method inside our websocket connection callback.  We execute the function inside the setInterval every 1000 miliseconds.  Then we say</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">socket</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="dl">'</span><span class="s1">date</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span><span class="dl">'</span><span class="s1">date</span><span class="dl">'</span><span class="p">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">()});</span></code></pre></figure>

<p>which says that we send JSON with the date to a listener on the client side labeled ‘date’.</p>

<p>So again, when we make our socket connection we repeatidly send JSON with the date to an on listener on the client every 1000 miliseconds.</p>

<p>Now we will update the client to recieve our data.</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"/socket.io/socket.io.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.js"</span><span class="nt">&gt;&lt;/script&gt;</span>  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;script&gt;</span>
      <span class="kd">var</span> <span class="nx">socket</span> <span class="o">=</span> <span class="nx">io</span><span class="p">.</span><span class="nx">connect</span><span class="p">();</span>

      <span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">date</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">){</span>
        <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#date</span><span class="dl">'</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">date</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="nt">&lt;/script&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"date"</span><span class="nt">&gt;&lt;/div&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span></code></pre></figure>

<p>You will notice we added very little.  We added a script to load jquery so that we can easily display the data we are recieving.  We added an id to our div so that we can use it with jquery.  And we added an on method to recieve our data from the emit method on the server.</p>

<p>Our on method simply says when we recieve an emit action labeled date, we take the data sent by the emit and put it inside our date div.</p>

<p>Try restarting your server and load the page.  You should now see the date displayed and being updated every second.  Go back to your server.js file and remove the 1000 from the setInterval.  Now the date is being updated every milisecond.</p>

<h4 id="sending-data-from-the-client-to-the-server">Sending Data From the Client To the Server:</h4>

<p>Now that we know how to send continuous data from the server to the client all we have left to do is learn how to send continuous data from the client back to the server.  You will be happy to know that this process is completely the same as what we just did.   So lets say we want to print every letter the user types into a textbox to the server console.</p>

<p>Again we will want to set up an emit function and an on listener.  This time the emit will be on the client side and the on listener will be on the server side.  We update our socket.html file to look like this:</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"/socket.io/socket.io.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
  <span class="nt">&lt;script&gt;</span>
  <span class="kd">var</span> <span class="nx">socket</span> <span class="o">=</span> <span class="nx">io</span><span class="p">.</span><span class="nx">connect</span><span class="p">();</span>
  <span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">date</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">){</span>
    <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#date</span><span class="dl">'</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">date</span><span class="p">);</span>
  <span class="p">});</span>

  <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
    <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#text</span><span class="dl">'</span><span class="p">).</span><span class="nx">keypress</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
      <span class="nx">socket</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="dl">'</span><span class="s1">client_data</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span><span class="dl">'</span><span class="s1">letter</span><span class="dl">'</span><span class="p">:</span> <span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">charCode</span><span class="p">)});</span>
    <span class="p">});</span>
  <span class="p">});</span>
  <span class="nt">&lt;/script&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"date"</span><span class="nt">&gt;&lt;/div&gt;</span>
  <span class="nt">&lt;textarea</span> <span class="na">id=</span><span class="s">"text"</span><span class="nt">&gt;&lt;/textarea&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span></code></pre></figure>

<p>Here all we have added is a textarea and an emit event to be triggered every time a key is pressed inside that textarea.  <code class="language-plaintext highlighter-rouge">String.fromCharCode(e.charCode)</code> takes the character code of the key that triggered the event and converts it back to a string of the character associated with that code number.  So if the “a” key triggered the event then our JSON would be <code class="language-plaintext highlighter-rouge">{'letter': 'a'}</code>.</p>

<p>Now we will add the on listener to our server.js file:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">listener</span> <span class="o">=</span> <span class="nx">io</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">server</span><span class="p">);</span>

<span class="nx">listener</span><span class="p">.</span><span class="nx">sockets</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">connection</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">socket</span><span class="p">){</span>
  <span class="c1">//send data to client</span>
  <span class="nx">setInterval</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
    <span class="nx">socket</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="dl">'</span><span class="s1">date</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span><span class="dl">'</span><span class="s1">date</span><span class="dl">'</span><span class="p">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">()});</span>
  <span class="p">},</span> <span class="mi">1000</span><span class="p">);</span>

  <span class="c1">//recieve client data</span>
  <span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">client_data</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">){</span>
    <span class="nx">process</span><span class="p">.</span><span class="nx">stdout</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">letter</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">});</span></code></pre></figure>

<p>You will see that here we have added the just a few lines again.</p>

<p>First we added</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">//recieve client data</span>
<span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">client_data</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">){</span>
  <span class="nx">process</span><span class="p">.</span><span class="nx">stdout</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">letter</span><span class="p">);</span>
<span class="p">});</span></code></pre></figure>

<p>This is our listener for the client_data emit call.  When an action triggers this listener we write the letter inside our JSON to the server console.  We use <code class="language-plaintext highlighter-rouge">process.stdout.write()</code> because it writes to stdout without inserting new line characters like console.log() will.</p>

<p>So restart your server and try everything out.  We should now have a clock runing in our browser with data from the server and data being streamed from the browser to the command line when we type in the textarea.</p>

<h4 id="conclusion">Conclusion:</h4>

<p>Hopefully, this has provided a more thorough introductory tutorial for beginners interested in using node.js and socket.io.  If you have any questions drop me a line.</p>

<p>You can find the example project <a href="https://github.com/DanielNIll/node-and-socket-example">here</a></p>
</p>
    </article>
    <br />
    <hr >
    <br />
  
    <article itemscope itemtype="http://schema.org/BlogPosting" itemprop="blogPost" class="listed_article">
      <h2 class="listed_headline" temprop="headline"><a href="/adding-a-wysiwyg-editor-to-django" rel="bookmark" title="Adding a WYSIWYG Editor to Django Admin">Adding a WYSIWYG Editor to Django Admin</a></h2>
      <small class="article_date">27 Feb 2012</small><br /><br />
      <p itemprop="text"><p>This will tell you pretty much everything you need to know about adding a WYSIWYG editor or any other javascript based features you may want to your django admin.</p>

<p>For most modern WYSIWYG editors installation is just a matter of adding a few lines of javascript and possibly adding a class or id to the textareas you want effected.  <a href="https://code.djangoproject.com/wiki/AddWYSIWYGEditor">This django wiki entry</a> gets you about half the way depending on the editor you want to use, but there are a few other tricks you can use depending on your editor of choice.  Here I’ll show the instalation process for  Tiny MCE and CKEditor, two of the more popular WYSIWYGs, both of which use different installation methods, to show you the modifications you can make to get most editors working.</p>

<p>###Tiny MCE</p>

<p>Tiny MCE isn’t a great editor and if given the choice I would suggest switching to something else (like CKEditor outlined below). But that’s niether here nor there.  It’s very popular, and provides a good example of methods you can use to install javascript plugins in the django admin.</p>

<p>So for Tiny MCE first you want to create a javascript file that has the basic installaiton script, we will call it textarea.js:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">tinyMCE</span><span class="p">.</span><span class="nx">init</span><span class="p">({</span>
  <span class="na">mode</span> <span class="p">:</span> <span class="dl">"</span><span class="s2">textareas</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">theme</span> <span class="p">:</span> <span class="dl">"</span><span class="s2">advanced</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">theme_advanced_toolbar_location</span> <span class="p">:</span> <span class="dl">"</span><span class="s2">top</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">theme_advanced_toolbar_align</span> <span class="p">:</span> <span class="dl">"</span><span class="s2">left</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">plugins</span> <span class="p">:</span> <span class="dl">"</span><span class="s2">table, save, advhr, advimage, advlink, emotions, iespell, insertdatetime, preview</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">theme_advanced_buttons1</span> <span class="p">:</span> <span class="dl">"</span><span class="s2">fullscreen, separator, preview, separator, bold, italic, underline, strikethrough, separator, bullist, numlist, outdent, indent, separator, undo, redo, separator, link, unlink, anchor, separator, image, cleanup, help, separator, code</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">auto_cleanup_word</span> <span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="na">plugin_insertdate_dateFormat</span> <span class="p">:</span> <span class="dl">"</span><span class="s2">%m/%d/%Y</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">plugin_insertdate_timeFormat</span> <span class="p">:</span> <span class="dl">"</span><span class="s2">%H:%M:%S</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">extended_valid_elements</span> <span class="p">:</span> <span class="dl">"</span><span class="s2">a[name|href|target=_blank|title|onclick], img[class|src|border=0|alt|title|hspace|vspace|width|height|align|onmouseover|onmouseout|name], hr[class|width|size|noshade], font[face|size|color|style], span[class|align|style]</span><span class="dl">"</span>
<span class="p">});</span></code></pre></figure>

<p>You can find the details of setting up your layout here, but the basic thing you need is a javascript file with</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">tinyMCE</span><span class="p">.</span><span class="nx">init</span><span class="p">({</span><span class="na">mode</span><span class="p">:</span> <span class="dl">"</span><span class="s2">textarea</span><span class="dl">"</span><span class="p">,</span> <span class="p">...});</span></code></pre></figure>

<p>Now, the key to adapting this method to installing other WYSIWYG editors is knowing that you can include any javascript file in the django admin.  To do this you simply need to add a media subclass to your custom admin model.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">SomeModelAdmin</span><span class="p">(</span><span class="n">admin</span><span class="p">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Media</span><span class="p">:</span>
        <span class="n">js</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s">'/media/tiny_mce/tiny_mce.js'</span><span class="p">,</span>
            <span class="s">'/media/textareas.js'</span><span class="p">,</span>
        <span class="p">)</span></code></pre></figure>

<p>This will load the resources listed into the /admin/app_name/model_name/.  As you can see for Tiny MCE you need to include the textareas.js file we just made and the main Tiny MCE script which I choose to store in my media directory.</p>

<p>For Tiny MCE that is all you need.  The WYSIWYG will be included on all textareas in your admin.</p>

<p>###CKEditor</p>

<p>CKEditor is a much nicer editor.  It’s primary drawback, however, is its limit documentation.  Luckily, because it is a nice editor there are plenty of tutorials for installation online.  The primary difference between installation for CKEditor and Tiny MCE is that you cannot assign the plugin to generic textareas like you can Tiny MCE. You must assign the editor by class or id.</p>

<p>But this is not a problem.  We just modify the django admin to have a custom class assigned to textareas.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">forms</span>

<span class="k">class</span> <span class="nc">SomeModelAdmin</span><span class="p">(</span><span class="n">admin</span><span class="p">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">formfield_overrides</span> <span class="o">=</span> <span class="p">{</span> <span class="n">models</span><span class="p">.</span><span class="n">TextField</span><span class="p">:</span> <span class="p">{</span><span class="s">'widget'</span><span class="p">:</span> <span class="n">forms</span><span class="p">.</span><span class="n">Textarea</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s">'class'</span><span class="p">:</span><span class="s">'ckeditor'</span><span class="p">})},</span> <span class="p">}</span>

    <span class="k">class</span> <span class="nc">Media</span><span class="p">:</span>
        <span class="n">js</span> <span class="o">=</span> <span class="p">(</span><span class="s">'/media/ckeditor/ckeditor.js'</span><span class="p">,)</span></code></pre></figure>

<p>Note that we are still including the ckeditor javascript file.  But a custom javascript file is not needed unless you want to modify the WYSIWYG’s layout.</p>

<p>So that is pretty much all you need to know.  Between those two methods you should be able to add most javascript based plugins to your django admin.</p>
</p>
    </article>
    <br />
    <hr >
    <br />
  
    <article itemscope itemtype="http://schema.org/BlogPosting" itemprop="blogPost" class="listed_article">
      <h2 class="listed_headline" temprop="headline"><a href="/well-thats-a-terrible-feature" rel="bookmark" title="Well That's a Terrible Feature">Well That's a Terrible Feature</a></h2>
      <small class="article_date">21 Feb 2012</small><br /><br />
      <p itemprop="text"><p>I recently discovered a really terrible feature now integrated into most modern browsers. The javascript window object is assumed appended to all javascript variables.</p>

<p>What does this mean?</p>

<p>A lot of developers, myself included until recently, probably do not know of this feature. Essentially assuming the window operator means that</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nb">window</span><span class="p">.</span><span class="nx">some_id_name</span></code></pre></figure>

<p>can be shorted to just</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">some_id_name</span></code></pre></figure>

<p>to get any html DOM object. Go ahead, open up Chrome and type ‘test’ in the javascript console.  You just got the DOM object of this paragraph.  Seem pretty nifty right?</p>

<p>It’s a great feature until you run into an error like the one that led me to discover this. The problem here is that this means that any DOM id you use on a page is now a protected object in javascript (but for some edge cases that I still haven’t fully worked out).</p>

<p>I discovered this feature when I tried doing this:</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;input</span> <span class="na">onclick=</span><span class="s">"’comment_reason(“$info[‘comment’]”)’/"</span> <span class="na">type=</span><span class="s">"’button’"</span><span class="nt">&gt;</span>
<span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"’comment_reason’/"</span> <span class="na">type=</span><span class="s">"’hidden’"</span><span class="nt">&gt;</span></code></pre></figure>

<p>and</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">comment_reason</span><span class="p">(</span><span class="nx">id</span><span class="p">){}</span></code></pre></figure>

<p>I know real daring of me</p>

<p>When run in chrome this trigger gives “Uncaught Type Error: object is not a function”. In firefox it gives the slightly more helpful “function not defined”. After working the error back to the trigger I talked to some other people.  Most were as flummoxed as I.  That is, until I found someone who had run into the same error and pointed me to the source of the problem.</p>

<p>The comment_reason namespace was already occupied.  It was occupied by the comment_reason object or rather the <code class="language-plaintext highlighter-rouge">window.comment_reason</code> object that was instantiated when the dom was loaded.</p>

<p>So is this a feature or a bug?</p>

<p>I say that the bugs this causes far out weigh the feature of not having to write window. Further limiting dom naming and imparting those naming restrictions on javascript seems completely unnecessary.</p>

<p>Unfortunately this doesn’t seem to be going away. <a href="http://stackoverflow.com/questions/1415747/javascript-function-and-form-name-conflict">This stackoverflow entry</a> explains what’s going on somewhat, and it would seem that this has been adopted as a core feature of html5. So for better or for worse it’s here to stay.</p>

<p>If anyone can give a more full explanation of why this is a worthwhile feature I’m all ears.</p>
</p>
    </article>
    <br />
    <hr >
    <br />
  
</div><!-- /#index -->

<div class="footer-wrap">
  <footer>
    <span>&copy; 2023 Daniel Nill.</span>

  </footer>
</div><!-- /.footer-wrap -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

<!-- Asynchronous Google Analytics snippet -->
<script>
  var _gaq = _gaq || [];
  var pluginUrl = 
 '//www.google-analytics.com/plugins/ga/inpage_linkid.js';
  _gaq.push(['_require', 'inpage_linkid', pluginUrl]);
  _gaq.push(['_setAccount', 'UA-29127035-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>



</body>
</html>
