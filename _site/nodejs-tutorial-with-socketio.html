<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Node.js Tutorial With Socket.io &#8211; Daniel Nill</title>
<meta name="description" content="">
<meta name="keywords" content="">
<!-- Twitter Cards -->
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="/images/">
<meta name="twitter:title" content="Node.js Tutorial With Socket.io">
<meta name="twitter:description" content="">
<meta name="twitter:creator" content="@DanielNill">
<link type="application/atom+xml" rel="alternate" href="/feed.xml" title="Daniel Nill" />

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Node.js Tutorial With Socket.io">
<meta property="og:description" content="">
<meta property="og:url" content="/nodejs-tutorial-with-socketio">
<meta property="og:site_name" content="Daniel Nill">





<link rel="canonical" href="/nodejs-tutorial-with-socketio">
<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Daniel Nill Feed">


<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Google Webfonts -->
<link href='http://fonts.googleapis.com/css?family=PT+Sans+Narrow:400,700|PT+Serif:400,700,400italic' rel='stylesheet' type='text/css'>
<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.min.css">

<!--[if (lt IE 9) & (!IEMobile)]>
<link rel="stylesheet" href="/assets/css/ie.min.css">
<![endif]-->

<meta http-equiv="cleartype" content="on">

</head>

<body class="page" itemscope itemtype="http://schema.org/WebPage">

<!--[if lt IE 9]><div class="browser-upgrade alert alert-info">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div><![endif]-->

<div class="navigation-wrapper">
	<div class="site-name">
		<a href="">Daniel Nill</a>
	</div><!-- /.site-name -->
	<div class="top-navigation">
		<nav role="navigation" itemscope itemtype="http://schema.org/SiteNavigationElement">
		    <ul>
		        
				<li><a href="/" >Posts</a></li>
		        
				<li><a href="/about.html" >About</a></li>
		        
		    </ul>
		</nav>
	</div><!-- /.top-navigation -->
</div><!-- /.navigation-wrapper -->




<div id="main" role="main"  itemprop="mainContentOfPage">
  <div class="article-author-side">
    <!-- <img src="/images/profile-photo-new1.jpg" class="bio-photo" alt="Daniel Nill bio photo"></a> -->
<p></p>
<br/>
<a href="http://twitter.com/DanielNill" class="author-social" target="_blank"><i class="icon-twitter"></i> Twitter</a>


<a href="http://linkedin.com/in/danielnill" class="author-social" target="_blank"><i class="icon-linkedin"></i> LinkedIn</a>

<a href="http://github.com/DanielNill" class="author-social" target="_blank"><i class="icon-github"></i> Github</a>



  </div>
  <article itemscope itemtype="http://schema.org/CreativeWork">
    <h1 itemprop="name">Node.js Tutorial With Socket.io</h1>
    <div class="article-wrap" itemprop="text">
      <h4 id="update-this-tutorial-has-been-update-to-run-on-node-500-and-socketio-137--if-you-have-trouble-with-getting-the-code-to-execute-make-sure-you-are-running-on-these-versions">Update: this tutorial has been update to run on node 5.0.0 and socket.io 1.3.7.  If you have trouble with getting the code to execute, make sure you are running on these versions.</h4>

<p>I was shocked to recently discover that there are no great quick tutorial on the basics of using socket.io with node js.  While there isn’t a whole lot to it, someone not familiar with node.js and the protocol for WebSockets is left to scrounge for random snippets of code.  Trying to parse the protocol of Websockets while learning the socket.io library and the basics of Node.js all at the same time is no easy feat.  And even more frustrating, someone new to Node.js is likely interested in trying it out for the features socket.io provide.</p>

<p>So I thought I would take a brief stab at filling this void. Lets get started:</p>

<h3 id="what-we-will-cover">What We Will Cover:</h3>

<p>In this tutorial we will cover</p>

<ul>
  <li>setting up a Node.js server and router (You can find this many places but it is a necessary first step)</li>
  <li>connecting socket.io to this server</li>
  <li>sending data to the client through the socket connection</li>
  <li>sending data to the server through the socket connection</li>
</ul>

<h4 id="your-basic-server">Your Basic Server:</h4>

<p>There are several modules you can use to initiate a server in Node.js, but they are all pretty much the same.  We will use the http library.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript">    <span class="kd">var</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">http</span><span class="dl">'</span><span class="p">);</span>

    <span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">();</span>
    <span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">8001</span><span class="p">);</span></code></pre></figure>

<p>With these 3 lines we have a server. You can save this as <code class="language-plaintext highlighter-rouge">server.js</code> and run <code class="language-plaintext highlighter-rouge">node server.js</code> and you will see your command line ‘stall’ on the process waiting for something to happen on the server. But that’s just it, a server that doesn’t do anything isn’t any fun.  So lets have it do something:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript">    <span class="kd">var</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">http</span><span class="dl">'</span><span class="p">);</span>

    <span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">){</span>
        <span class="nx">response</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="p">{</span><span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">text/html</span><span class="dl">'</span><span class="p">});</span>
        <span class="nx">response</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="dl">'</span><span class="s1">hello world</span><span class="dl">'</span><span class="p">);</span>
        <span class="nx">response</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
    <span class="p">});</span>

    <span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">8001</span><span class="p">);</span></code></pre></figure>

<p>With these changes we are now sending something to the client.  Save <code class="language-plaintext highlighter-rouge">server.js</code> and run <code class="language-plaintext highlighter-rouge">node server.js</code> .  Still nothing happens, but if we go to <a href="http://localhost:8001">http://localhost:8001</a> we see a page that says “hello world”!</p>

<p>The actions we put inside createServer will be executed each time <a href="http://localhost:8001">http://localhost:8001</a> is loaded.  Lets slow down and go through what we did line by line.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">){});</span>
<span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">8001</span><span class="p">);</span></code></pre></figure>

<p>Here we have created the server just as we had the first time, but now we are passing it an anonymous function that defines what happens with each request to the server and response from the server.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">){</span>
    <span class="c1">//...</span>
<span class="p">});</span></code></pre></figure>

<p>Here we simply say on every request response interaction with the server we will take some action.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript">    <span class="nx">response</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="p">{</span><span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">text/html</span><span class="dl">'</span><span class="p">});</span></code></pre></figure>

<p>Here we define how we are sending data to the client.  All elements declared by <code class="language-plaintext highlighter-rouge">writeHead</code> are written to the response header.  Our <code class="language-plaintext highlighter-rouge">writeHead</code> describes the HTTP Code of the response and the content type.  The content type can be any of the common MIME types.  You can define several other elements found in the HTTP response header, but we won’t worry about that for this tutorial.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">response</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="dl">'</span><span class="s1">hello world</span><span class="dl">'</span><span class="p">);</span></code></pre></figure>

<p>This defines the actual contents of our response.  More precicely it defines the action of the response.  Write says the the contents of the response is “hello world” and upon executing the response the server will append that content to the document being served.</p>

<p>Finally we have</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript">    <span class="nx">response</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span></code></pre></figure>

<p>This simply says that we are done defining the response and action and executes them.</p>

<h4 id="creating-the-router">Creating The Router:</h4>

<p>So now we have very basic server, but it can only server our root domain.  Lets fix that.  We add the following to <code class="language-plaintext highlighter-rouge">server.js</code>.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript">    <span class="kd">var</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">http</span><span class="dl">"</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">url</span><span class="dl">'</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">fs</span><span class="dl">'</span><span class="p">);</span>

    <span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">){</span>
        <span class="kd">var</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">url</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">url</span><span class="p">).</span><span class="nx">pathname</span><span class="p">;</span>

        <span class="k">switch</span><span class="p">(</span><span class="nx">path</span><span class="p">){</span>
            <span class="k">case</span> <span class="dl">'</span><span class="s1">/</span><span class="dl">'</span><span class="p">:</span>
                <span class="nx">response</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="p">{</span><span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">text/html</span><span class="dl">'</span><span class="p">});</span>
                <span class="nx">response</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="dl">'</span><span class="s1">hello world</span><span class="dl">'</span><span class="p">);</span>
                <span class="nx">response</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="dl">'</span><span class="s1">/socket.html</span><span class="dl">'</span><span class="p">:</span>
                <span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="nx">__dirname</span> <span class="o">+</span> <span class="nx">path</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">data</span><span class="p">){</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">){</span>
                        <span class="nx">response</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">404</span><span class="p">);</span>
                        <span class="nx">response</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="dl">"</span><span class="s2">opps this doesn't exist - 404</span><span class="dl">"</span><span class="p">);</span>
                        <span class="nx">response</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
                    <span class="p">}</span>
                    <span class="k">else</span><span class="p">{</span>
                        <span class="nx">response</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="p">{</span><span class="dl">"</span><span class="s2">Content-Type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">text/html</span><span class="dl">"</span><span class="p">});</span>
                        <span class="nx">response</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="dl">"</span><span class="s2">utf8</span><span class="dl">"</span><span class="p">);</span>
                        <span class="nx">response</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
                    <span class="p">}</span>
                <span class="p">});</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="nl">default</span><span class="p">:</span>
                <span class="nx">response</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">404</span><span class="p">);</span>
                <span class="nx">response</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="dl">"</span><span class="s2">opps this doesn't exist - 404</span><span class="dl">"</span><span class="p">);</span>
                <span class="nx">response</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
                <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">});</span>

    <span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">8001</span><span class="p">);</span></code></pre></figure>

<p>If you save this code as <code class="language-plaintext highlighter-rouge">server.js</code> you can rerun <code class="language-plaintext highlighter-rouge">node server.js</code> when you load <a href="http://localhost:8001">http://localhost:8001</a> into your browser you will see that nothing has changed.  We still get “hello world” in the browser.  However, we just build a router so now we should be able to go other urls.  Looking at the code we just wrote it seems like we should be able to visit <a href="http://localhost:8001/socket.html">http://localhost:8001/socket.html</a> and something should happen.  But when we try that we get our 404 message.  Lets go through what we added and see why.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">url</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">fs</span><span class="dl">'</span><span class="p">);</span></code></pre></figure>

<p>Here we have added two new modules, <code class="language-plaintext highlighter-rouge">url</code> and <code class="language-plaintext highlighter-rouge">fs</code>.  <code class="language-plaintext highlighter-rouge">url</code> is used to to parse interpret and manipulate urls, you can learn more about it <a href="http://nodejs.org/docs/v0.3.1/api/url.html">here</a>.  <code class="language-plaintext highlighter-rouge">fs</code> is used to handle files, you can read about it <a href="http://nodejs.org/api/fs.html">here</a>.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">url</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">url</span><span class="p">).</span><span class="nx">pathname</span><span class="p">;</span></code></pre></figure>

<p>With this line we get the path that follows our root domain.  So <code class="language-plaintext highlighter-rouge">localhost:8001</code> will assign ‘/’ to path and <code class="language-plaintext highlighter-rouge">localhost:8001/some_other_path</code> will assign ‘some_other_path’ to path.  You can test this by adding <code class="language-plaintext highlighter-rouge">console.log(path)</code> immediately after this line.</p>

<p>Next we perform a switch case on the path to decide what we want the server to do.  If the path is root then we perform our hello world action.  If the path is socket.html then the server performs a different action.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="nx">__dirname</span> <span class="o">+</span> <span class="nx">path</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">data</span><span class="p">){...});</span></code></pre></figure>

<p>Here we use the fs module to open the file that is on the path the server recieves.  Like most methods in node.js readFile takes a callback function to define its action. This function defines the action we want taken once the file’s contents have been gathered.  In this case we are wanting to get the file socket.html.  At this point you have probably noticed why we were getting that 404 message, socket.html doesn’t exist!!!</p>

<p>Let’s go through the rest of our changes and then we will solve that problem.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">){</span>
    <span class="nx">response</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">404</span><span class="p">);</span>
    <span class="nx">response</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="dl">"</span><span class="s2">opps this doesn't exist - 404</span><span class="dl">"</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>

<p>The first argument we pass to the readFile callback contains the error code if we are unable to open the file (like say it doesn’t exist).  The second variable passed is the contents of the file if we are able to open it.  So we say that if there is an error opening the file on the path then we return a 404 header and write a message to the returned document.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="k">else</span><span class="p">{</span>
    <span class="nx">response</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="p">{</span><span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">text/html</span><span class="dl">'</span><span class="p">});</span>
    <span class="nx">response</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="dl">'</span><span class="s1">utf8</span><span class="dl">'</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>

<p>Here is what we want to happen once we have a readable file.  It’s the same as what we do when we route to ‘/’ but instead we write the contents of the document we read and encode it as utf8.</p>

<p>You will also want to note that we still call <code class="language-plaintext highlighter-rouge">response.end()</code> at the bottom of our createServer function so that whatever actions are routed to the response object are closed and executed.</p>

<p>Now that we see why we are getting that 404 lets fix it.  Lets create a new page where we will use socket.io</p>

<h4 id="adding-socketio">Adding Socket.io:</h4>

<p>To start with we want to get rid of the 404 error when we visit http://localhost:8001/socket.html so we are going to create a socket.html file.</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>This is our socket.html file<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span></code></pre></figure>

<p>Now we save this to the same directory as our server.js file and run <code class="language-plaintext highlighter-rouge">node server.js</code>.  Now when we go to <a href="http://localhost:8001/socket.html">http://localhost:8001/socket.html</a> we should see a page with “This is our socket.html file”.</p>

<p>That’s great but that’s not really what we’re here for.  So let’s get into the real bread and butter, Socket.io!</p>

<p>First we will instantiate socket.io and extend it from our server.  We change our server.js file to look like this:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">http</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">url</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">fs</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">io</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">socket.io</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">url</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">url</span><span class="p">).</span><span class="nx">pathname</span><span class="p">;</span>

    <span class="k">switch</span><span class="p">(</span><span class="nx">path</span><span class="p">){</span>
        <span class="k">case</span> <span class="dl">'</span><span class="s1">/</span><span class="dl">'</span><span class="p">:</span>
            <span class="nx">response</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="p">{</span><span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">text/html</span><span class="dl">'</span><span class="p">});</span>
            <span class="nx">response</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="dl">'</span><span class="s1">hello world</span><span class="dl">'</span><span class="p">);</span>
            <span class="nx">response</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="dl">'</span><span class="s1">/socket.html</span><span class="dl">'</span><span class="p">:</span>
            <span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="nx">__dirname</span> <span class="o">+</span> <span class="nx">path</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">data</span><span class="p">){</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">){</span>
                    <span class="nx">response</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">404</span><span class="p">);</span>
                    <span class="nx">response</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="dl">"</span><span class="s2">opps this doesn't exist - 404</span><span class="dl">"</span><span class="p">);</span>
                    <span class="nx">response</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
                <span class="p">}</span>
                <span class="k">else</span><span class="p">{</span>
                    <span class="nx">response</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="p">{</span><span class="dl">"</span><span class="s2">Content-Type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">text/html</span><span class="dl">"</span><span class="p">});</span>
                    <span class="nx">response</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="dl">"</span><span class="s2">utf8</span><span class="dl">"</span><span class="p">);</span>
                    <span class="nx">response</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
                <span class="p">}</span>
            <span class="p">});</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="nl">default</span><span class="p">:</span>
            <span class="nx">response</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">404</span><span class="p">);</span>
            <span class="nx">response</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="dl">"</span><span class="s2">opps this doesn't exist - 404</span><span class="dl">"</span><span class="p">);</span>
            <span class="nx">response</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
            <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">8001</span><span class="p">);</span>

<span class="nx">io</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">server</span><span class="p">);</span></code></pre></figure>

<p>All we have added here is a require for the socket.io module at the top and the line <code class="language-plaintext highlighter-rouge">io.listen(server);</code>.  This simply says that when the server is instantiated (note: not connected to) we will open a listener for socket.io.  This means that our server will ‘listen’ for pages loaded by the server that have a WebSocket connection instantiated on them.</p>

<p>So lets see what happens when we run node server.js and reload <a href="http://localhost:8001/socket.html">http://localhost:8001/socket.html</a>.  Nothing seems to change in the browser but our server is now listening for any websocket connections that may occur.</p>

<p>Now that the server is listening for socket.io connections lets give our socket.html page a WebSockets connection so that the server will actually have something to talk to.  To do this we simple change socket.html to:</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"/socket.io/socket.io.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;script&gt;</span>
      <span class="kd">var</span> <span class="nx">socket</span> <span class="o">=</span> <span class="nx">io</span><span class="p">.</span><span class="nx">connect</span><span class="p">();</span>
    <span class="nt">&lt;/script&gt;</span>
    <span class="nt">&lt;div&gt;</span>This is our socket.html file<span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span></code></pre></figure>

<p>Here we have added the socket.io.js script and a body script to create the client side socket connection. Now we have a WebSockets connection between the client and our server.  Let’s try sending some information from the server to the client through our socket.io connection</p>

<h4 id="sending-data-to-the-client">Sending Data To The Client:</h4>

<p>Now we want to send some data from the server to socket.html.  All data transactions in socket.io, like in most of node.js, can be handled with callbacks primarily we will utilize the <code class="language-plaintext highlighter-rouge">on</code> method.  The on method in simplistic terms is used to map a method name to an annonymous function.  Because we are using socket.io the on method simply uses the listener on the websocket connection for the method name and when it is found it executes the mapped annonymous function.</p>

<p>The flip side of the on method is the emit method.  The emit method sends the mapped method name to the client or the server.  It takes two arguments.  The mapped method name and the data to be fed to the annonymous function.</p>

<p>So here is what we add to server.js:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">listener</span> <span class="o">=</span> <span class="nx">io</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">server</span><span class="p">);</span>
<span class="nx">listener</span><span class="p">.</span><span class="nx">sockets</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">connection</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">socket</span><span class="p">){</span>
    <span class="nx">socket</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="dl">'</span><span class="s1">message</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span><span class="dl">'</span><span class="s1">message</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">hello world</span><span class="dl">'</span><span class="p">});</span>
<span class="p">});</span></code></pre></figure>

<p>All we are saying here is when the listener gets a call for the “connection” action we will perform the function that follows it.  When the “connection” action is called we trigger an emit action that will send a “message” action to the client.  The “message” action will send the json object {‘message’: ‘hello world’} .</p>

<p>The ‘connection’ action is triggered when io.connection(); is executed on socket.html.  Socket.io has several build in mappable actions, but we can also create custom mappable actions as we will see shortly.</p>

<p>To retrieve the emitted “message” action on socket.html we just add an on method listener:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">socket</span> <span class="o">=</span> <span class="nx">io</span><span class="p">.</span><span class="nx">connect</span><span class="p">();</span>

<span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">message</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">){</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
<span class="p">});</span></code></pre></figure>

<p>Now we have an emit on the server side that sends data to the client side.  And an on method on the client side that recieves that data and writes it to the browser’s console.  Run node server.js again and reload the page.  If you open up the javascript console of your browser you will note that “hello world” has been written.  Further more, if you check your command line you will note that you have more debug statements from socket.io explaining the transmission and contents of the message.</p>

<p>But we could just as easily produce this content through a normal page load or ajax call.  We want the actions transmitted through our socket connection to be continuous.  A good example of this is a clock. A clock updates the data it displays literally every second.</p>

<p>So lets do that.  In javascript we can create repeatable actions with the setInterval function.  setInterval takes an anonymous function and a number of miliseconds as arguments and executes the function every count of the miliseconds.  So if you want to print hello world every one second you would simply say</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">setInterval</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">hello world</span><span class="dl">'</span><span class="p">);</span>
<span class="p">},</span> <span class="mi">1000</span><span class="p">);</span></code></pre></figure>

<p>So going back to our server.js file we want to emit data for our clock through our socket connection.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">io</span><span class="p">.</span><span class="nx">sockets</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">connection</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">socket</span><span class="p">){</span>
    <span class="c1">//send data to client</span>
    <span class="nx">setInterval</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
        <span class="nx">socket</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="dl">'</span><span class="s1">date</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span><span class="dl">'</span><span class="s1">date</span><span class="dl">'</span><span class="p">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">()});</span>
    <span class="p">},</span> <span class="mi">1000</span><span class="p">);</span>
<span class="p">});</span></code></pre></figure>

<p>We are doing a few things here.  First we set up our setInterval method inside our websocket connection callback.  We execute the function inside the setInterval every 1000 miliseconds.  Then we say</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">socket</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="dl">'</span><span class="s1">date</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span><span class="dl">'</span><span class="s1">date</span><span class="dl">'</span><span class="p">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">()});</span></code></pre></figure>

<p>which says that we send JSON with the date to a listener on the client side labeled ‘date’.</p>

<p>So again, when we make our socket connection we repeatidly send JSON with the date to an on listener on the client every 1000 miliseconds.</p>

<p>Now we will update the client to recieve our data.</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"/socket.io/socket.io.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.js"</span><span class="nt">&gt;&lt;/script&gt;</span>  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;script&gt;</span>
      <span class="kd">var</span> <span class="nx">socket</span> <span class="o">=</span> <span class="nx">io</span><span class="p">.</span><span class="nx">connect</span><span class="p">();</span>

      <span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">date</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">){</span>
        <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#date</span><span class="dl">'</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">date</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="nt">&lt;/script&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"date"</span><span class="nt">&gt;&lt;/div&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span></code></pre></figure>

<p>You will notice we added very little.  We added a script to load jquery so that we can easily display the data we are recieving.  We added an id to our div so that we can use it with jquery.  And we added an on method to recieve our data from the emit method on the server.</p>

<p>Our on method simply says when we recieve an emit action labeled date, we take the data sent by the emit and put it inside our date div.</p>

<p>Try restarting your server and load the page.  You should now see the date displayed and being updated every second.  Go back to your server.js file and remove the 1000 from the setInterval.  Now the date is being updated every milisecond.</p>

<h4 id="sending-data-from-the-client-to-the-server">Sending Data From the Client To the Server:</h4>

<p>Now that we know how to send continuous data from the server to the client all we have left to do is learn how to send continuous data from the client back to the server.  You will be happy to know that this process is completely the same as what we just did.   So lets say we want to print every letter the user types into a textbox to the server console.</p>

<p>Again we will want to set up an emit function and an on listener.  This time the emit will be on the client side and the on listener will be on the server side.  We update our socket.html file to look like this:</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"/socket.io/socket.io.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
  <span class="nt">&lt;script&gt;</span>
  <span class="kd">var</span> <span class="nx">socket</span> <span class="o">=</span> <span class="nx">io</span><span class="p">.</span><span class="nx">connect</span><span class="p">();</span>
  <span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">date</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">){</span>
    <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#date</span><span class="dl">'</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">date</span><span class="p">);</span>
  <span class="p">});</span>

  <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
    <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#text</span><span class="dl">'</span><span class="p">).</span><span class="nx">keypress</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
      <span class="nx">socket</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="dl">'</span><span class="s1">client_data</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span><span class="dl">'</span><span class="s1">letter</span><span class="dl">'</span><span class="p">:</span> <span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">charCode</span><span class="p">)});</span>
    <span class="p">});</span>
  <span class="p">});</span>
  <span class="nt">&lt;/script&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"date"</span><span class="nt">&gt;&lt;/div&gt;</span>
  <span class="nt">&lt;textarea</span> <span class="na">id=</span><span class="s">"text"</span><span class="nt">&gt;&lt;/textarea&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span></code></pre></figure>

<p>Here all we have added is a textarea and an emit event to be triggered every time a key is pressed inside that textarea.  <code class="language-plaintext highlighter-rouge">String.fromCharCode(e.charCode)</code> takes the character code of the key that triggered the event and converts it back to a string of the character associated with that code number.  So if the “a” key triggered the event then our JSON would be <code class="language-plaintext highlighter-rouge">{'letter': 'a'}</code>.</p>

<p>Now we will add the on listener to our server.js file:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">listener</span> <span class="o">=</span> <span class="nx">io</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">server</span><span class="p">);</span>

<span class="nx">listener</span><span class="p">.</span><span class="nx">sockets</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">connection</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">socket</span><span class="p">){</span>
  <span class="c1">//send data to client</span>
  <span class="nx">setInterval</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
    <span class="nx">socket</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="dl">'</span><span class="s1">date</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span><span class="dl">'</span><span class="s1">date</span><span class="dl">'</span><span class="p">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">()});</span>
  <span class="p">},</span> <span class="mi">1000</span><span class="p">);</span>

  <span class="c1">//recieve client data</span>
  <span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">client_data</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">){</span>
    <span class="nx">process</span><span class="p">.</span><span class="nx">stdout</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">letter</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">});</span></code></pre></figure>

<p>You will see that here we have added the just a few lines again.</p>

<p>First we added</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">//recieve client data</span>
<span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">client_data</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">){</span>
  <span class="nx">process</span><span class="p">.</span><span class="nx">stdout</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">letter</span><span class="p">);</span>
<span class="p">});</span></code></pre></figure>

<p>This is our listener for the client_data emit call.  When an action triggers this listener we write the letter inside our JSON to the server console.  We use <code class="language-plaintext highlighter-rouge">process.stdout.write()</code> because it writes to stdout without inserting new line characters like console.log() will.</p>

<p>So restart your server and try everything out.  We should now have a clock runing in our browser with data from the server and data being streamed from the browser to the command line when we type in the textarea.</p>

<h4 id="conclusion">Conclusion:</h4>

<p>Hopefully, this has provided a more thorough introductory tutorial for beginners interested in using node.js and socket.io.  If you have any questions drop me a line.</p>

<p>You can find the example project <a href="https://github.com/DanielNIll/node-and-socket-example">here</a></p>

    </div><!-- /.article-wrap -->
  </article>
</div><!-- /#index -->

<div class="footer-wrap">
  <footer>
    <span>&copy; 2023 Daniel Nill.</span>

  </footer>
</div><!-- /.footer-wrap -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

<!-- Asynchronous Google Analytics snippet -->
<script>
  var _gaq = _gaq || [];
  var pluginUrl = 
 '//www.google-analytics.com/plugins/ga/inpage_linkid.js';
  _gaq.push(['_require', 'inpage_linkid', pluginUrl]);
  _gaq.push(['_setAccount', 'UA-29127035-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

          

</body>
</html>
